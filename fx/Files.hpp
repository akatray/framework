// ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// Pragma.
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#pragma once

// ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// Imports.
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#include "Types.hpp"
#include "Error.hpp"
#include <vector>
#include <filesystem>

// ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// Framework.
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
namespace fx::files
{
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Collect all files in directory. Optionaly do same for subdirectories.
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	auto buildFileList ( const str& _Dir, const bool _Recursive = false )
	{
		auto Files = std::vector<std::filesystem::path>();

		try
		{
			if(_Recursive)
			{
				for(auto& Entry : std::filesystem::recursive_directory_iterator(_Dir))
				{
					if(Entry.is_regular_file())	Files.push_back(Entry.path());
				}
			}

			else
			{
				for(auto& Entry : std::filesystem::directory_iterator(_Dir))
				{
					if(Entry.is_regular_file())	Files.push_back(Entry.path());
				}
			}
		}

		catch (const std::exception& e)
		{
			throw Error("fx::files", "", "buildFileList", 0, e.what());
		}

		catch (...)
		{
			throw Error("fx::files", "", "buildFileList", 0, "Unknown exception!");
		}

		return Files;
	}

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Get file name from string. (Name.Extension).
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	auto removeExtension ( const str& _Filepath )
	{
		for(auto c = iMAX(_Filepath.size()-1); c > 0; --c) if(_Filepath[c] == '.') return _Filepath.substr(0, c);
		return str();
	}

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Get file extension from string. (Name.Extension).
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	auto getExtension ( const str& _Filepath )
	{
		for(auto c = iMAX(_Filepath.size()-1); c > 0; --c) if(_Filepath[c] == '.') return _Filepath.substr(c+1);
		return str();
	}
}
